---
import profile from '../data/profile.json';

const nav = [
  { label: 'Home', href: '/', color: 'blue' },
  { label: 'About', href: '/about', color: 'blue' },
  { label: 'Work', href: '/work', color: 'orange' },
  { label: 'Writing', href: '/writing', color: 'red' },
  { label: 'Social', href: '/social', color: 'white' },
  { label: 'AGI Timeline', href: '/agi', color: 'black' },
  { label: 'Survival OS', href: '/survival-os', color: 'red' },
  { label: 'Map', href: '/map', color: 'blue' },
  { label: 'Now', href: '/now', color: 'yellow' },
  { label: 'Contact', href: '/contact', color: 'orange' },
  { label: 'Link Hub', href: '/link-hub', color: 'yellow' }
];

const currentPath = Astro.url.pathname.replace(/\/+$/, '') || '/';
const normalize = (path: string) => path.replace(/\/+$/, '') || '/';
const isActive = (href: string) => {
  const target = normalize(href);
  return currentPath === target || (target !== '/' && currentPath.startsWith(`${target}/`));
};
---

<header class="site-header sticky top-0 z-50">
  <div class="flex w-full items-center justify-between px-4 py-3 md:px-6 xl:px-8">
    <a href="/" class="font-display text-lg font-bold tracking-tight text-accent">a_e.s_</a>
    <nav aria-label="Main navigation" class="hidden gap-4 md:flex">
      {nav.map((item) => (
        <a
          href={item.href}
          class="text-sm hover:text-accent no-underline"
          {...(item.color ? { 'data-color': item.color } : {})}
          {...(isActive(item.href) ? { 'aria-current': 'page' } : {})}
        >
          {item.label}
        </a>
      ))}
    </nav>
    <div class="flex items-center gap-2">
      <a href={profile.site_url} class="pill rounded px-3 py-1 text-sm" aria-label="Open live site">
        Live
      </a>
      <button id="theme-toggle" aria-label="Toggle dark mode" class="pill rounded px-3 py-1 text-sm">Theme</button>
    </div>
  </div>
</header>

<script is:inline>
  const root = document.documentElement;
  const saved = localStorage.getItem('theme');
  if (saved === 'dark') root.classList.add('dark');
  document.getElementById('theme-toggle')?.addEventListener('click', () => {
    root.classList.toggle('dark');
    localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
  });
</script>
